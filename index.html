<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>ä»Šæ—¥è¿åŠ¿æµ‹ç®—</title>
  <style>
    :root{
      --glass: rgba(255,255,255,.12);
      --stroke: rgba(255,255,255,.18);
      --shadow: 0 18px 50px rgba(0,0,0,.22);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.68);
    }
    *{margin:0;padding:0;box-sizing:border-box;font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", sans-serif;}
    body{
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      background: radial-gradient(1200px 700px at 20% 10%, rgba(255, 151, 197, .55), transparent 60%),
                  radial-gradient(900px 600px at 85% 30%, rgba(95, 187, 255, .55), transparent 60%),
                  radial-gradient(900px 600px at 40% 85%, rgba(153, 255, 200, .4), transparent 60%),
                  linear-gradient(135deg, #10182F, #0A1020);
      overflow-x:hidden;
      padding: 18px;
      color: var(--text);
    }

    /* subtle floating stars */
    .stars{
      position:fixed; inset:0;
      pointer-events:none;
      opacity:.35;
      background-image:
        radial-gradient(2px 2px at 20px 30px, rgba(255,255,255,.9), transparent 55%),
        radial-gradient(1.5px 1.5px at 120px 80px, rgba(255,255,255,.8), transparent 55%),
        radial-gradient(1px 1px at 200px 140px, rgba(255,255,255,.7), transparent 55%),
        radial-gradient(2px 2px at 280px 90px, rgba(255,255,255,.8), transparent 55%),
        radial-gradient(1px 1px at 360px 30px, rgba(255,255,255,.7), transparent 55%),
        radial-gradient(2px 2px at 460px 160px, rgba(255,255,255,.8), transparent 55%);
      background-size: 520px 220px;
      animation: drift 12s linear infinite;
    }
    @keyframes drift{ from{ transform: translateY(0);} to{ transform: translateY(-220px);} }

    .wrap{
      width:min(460px, 100%);
      position:relative;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      justify-content:center;
      margin-bottom: 14px;
      user-select:none;
    }
    .logo{
      width: 36px; height: 36px;
      border-radius: 12px;
      background: linear-gradient(135deg, rgba(255,255,255,.35), rgba(255,255,255,.08));
      border: 1px solid rgba(255,255,255,.22);
      box-shadow: 0 8px 18px rgba(0,0,0,.22);
      display:grid; place-items:center;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .logo span{
      font-size: 18px;
      filter: drop-shadow(0 6px 14px rgba(0,0,0,.25));
    }
    .brand h1{
      font-size: 18px;
      letter-spacing: .5px;
      font-weight: 700;
    }
    .brand p{
      font-size: 12px;
      color: var(--muted);
      margin-top:2px;
    }

    .card{
      background: var(--glass);
      border: 1px solid var(--stroke);
      border-radius: 22px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      padding: 18px;
      position:relative;
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute;
      inset:-60px;
      background: conic-gradient(from 180deg, rgba(255,255,255,.0), rgba(255,255,255,.18), rgba(255,255,255,.0));
      filter: blur(20px);
      opacity:.5;
      animation: rotate 8s linear infinite;
    }
    @keyframes rotate{ to{ transform: rotate(360deg);} }
    .card > *{ position:relative; z-index:1; }

    .headline{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 14px;
    }
    .headline .title{
      display:flex;
      flex-direction:column;
      gap:5px;
    }
    .headline h2{
      font-size: 18px;
      font-weight: 800;
      letter-spacing:.4px;
    }
    .headline small{
      color: var(--muted);
      line-height: 1.4;
    }
    .chip{
      font-size: 12px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.2);
      background: rgba(255,255,255,.08);
      white-space: nowrap;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .chip b{font-weight:800;}

    .form{
      display:grid;
      gap: 12px;
      margin-top: 10px;
    }
    .field{
      display:flex;
      flex-direction:column;
      gap: 6px;
    }
    label{
      font-size: 12px;
      color: var(--muted);
    }
    input, select{
      width: 100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(10,16,32,.25);
      color: var(--text);
      outline: none;
      transition: .25s ease;
    }
    input::placeholder{ color: rgba(255,255,255,.45); }
    input:focus, select:focus{
      border-color: rgba(255,255,255,.45);
      box-shadow: 0 0 0 4px rgba(255,255,255,.08);
      transform: translateY(-1px);
    }

    .btn{
      margin-top: 6px;
      width: 100%;
      padding: 13px 14px;
      border-radius: 16px;
      border: none;
      cursor:pointer;
      color: #0A1020;
      font-weight: 900;
      letter-spacing: .6px;
      background: linear-gradient(135deg, #FFB7E3, #6AD6FF, #B7FFDC);
      box-shadow: 0 16px 30px rgba(0,0,0,.25);
      transition: .22s ease;
      position:relative;
      overflow:hidden;
    }
    .btn::after{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(120px 80px at 20% 30%, rgba(255,255,255,.7), transparent 60%);
      opacity:.65;
      transform: translateX(-60%);
      transition: .35s ease;
    }
    .btn:hover::after{ transform: translateX(0%); }
    .btn:active{ transform: translateY(1px) scale(.99); }
    .btn[disabled]{
      opacity:.6; cursor:not-allowed; filter: grayscale(.2);
    }

    .result{
      margin-top: 14px;
      border-radius: 18px;
      padding: 14px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.07);
      display:none;
      animation: fadeIn .55s ease both;
    }
    @keyframes fadeIn{
      from{ opacity:0; transform: translateY(10px); }
      to{ opacity:1; transform: translateY(0); }
    }
    .resultHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 10px;
    }
    .resultHeader h3{
      font-size: 16px;
      font-weight: 900;
    }
    .badge{
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.18);
      white-space:nowrap;
    }

    .scoreRow{
      display:grid;
      gap: 10px;
    }
    .bar{
      display:grid;
      gap: 6px;
    }
    .barTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      font-size: 12px;
      color: rgba(255,255,255,.78);
    }
    .track{
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.12);
    }
    .fill{
      height:100%;
      width:0%;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(255,183,227,.95), rgba(106,214,255,.95), rgba(183,255,220,.95));
      transition: width .65s ease;
    }

    .advice{
      margin-top: 12px;
      padding: 12px;
      border-radius: 16px;
      background: rgba(10,16,32,.22);
      border: 1px dashed rgba(255,255,255,.18);
      line-height: 1.65;
      color: rgba(255,255,255,.86);
      font-size: 13px;
      white-space: pre-wrap;
    }

    .meta{
      display:flex;
      flex-wrap:wrap;
      gap: 8px;
      margin-top: 10px;
    }
    .tag{
      font-size: 12px;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.86);
    }

    .footer{
      margin-top: 14px;
      text-align:center;
      color: rgba(255,255,255,.55);
      font-size: 12px;
      line-height: 1.5;
    }

    /* mobile polish */
    @media (max-width: 360px){
      .headline h2{ font-size: 16px; }
      .btn{ padding: 12px; }
    }
  </style>
</head>
<body>
  <div class="stars"></div>

  <div class="wrap">
    <div class="brand">
      <div class="logo"><span>ğŸ”®</span></div>
      <div>
        <h1>ä»Šæ—¥è¿åŠ¿æµ‹ç®—</h1>
        <p>è¾“å…¥ä¿¡æ¯ï¼ŒæŠ½å–å±äºä½ çš„å¹¸è¿æç¤º</p>
      </div>
    </div>

    <div class="card">
      <div class="headline">
        <div class="title">
          <h2>æµ‹ä¸€æµ‹ï¼šä½ ä»Šå¤©çš„å¥½è¿æŒ‡æ•°</h2>
          <small>å»ºè®®æ¯å¤©æµ‹ä¸€æ¬¡ï¼Œä¿æŒå¿ƒæ€ä¸è¡ŒåŠ¨åŒæ­¥ âœ¨</small>
        </div>
        <div class="chip">ä»Šæ—¥ï¼š<b id="todayStr"></b></div>
      </div>

      <div class="form">
        <div class="field">
          <label>ä½ çš„åå­—ï¼ˆå¯é€‰ï¼‰</label>
          <input id="name" type="text" placeholder="ä¾‹å¦‚ï¼šå°æ¡‚ / ä½³ä½³ / Alex" maxlength="12" />
        </div>

        <div class="field">
          <label>é€‰æ‹©æ˜Ÿåº§</label>
          <select id="zodiac">
            <option value="ç™½ç¾Šåº§">ç™½ç¾Šåº§ â™ˆ</option>
            <option value="é‡‘ç‰›åº§">é‡‘ç‰›åº§ â™‰</option>
            <option value="åŒå­åº§">åŒå­åº§ â™Š</option>
            <option value="å·¨èŸ¹åº§">å·¨èŸ¹åº§ â™‹</option>
            <option value="ç‹®å­åº§">ç‹®å­åº§ â™Œ</option>
            <option value="å¤„å¥³åº§">å¤„å¥³åº§ â™</option>
            <option value="å¤©ç§¤åº§">å¤©ç§¤åº§ â™</option>
            <option value="å¤©èåº§">å¤©èåº§ â™</option>
            <option value="å°„æ‰‹åº§">å°„æ‰‹åº§ â™</option>
            <option value="æ‘©ç¾¯åº§">æ‘©ç¾¯åº§ â™‘</option>
            <option value="æ°´ç“¶åº§">æ°´ç“¶åº§ â™’</option>
            <option value="åŒé±¼åº§">åŒé±¼åº§ â™“</option>
          </select>
        </div>

        <div class="field">
          <label>é€‰æ‹©æ—¥æœŸï¼ˆå¯é€‰ï¼Œç”¨äºç”Ÿæˆæ›´ä¸ªæ€§åŒ–è¿åŠ¿ï¼‰</label>
          <input id="date" type="date" />
        </div>

        <button class="btn" id="btn">âœ¨ ä¸€é”®æµ‹è¿åŠ¿</button>
      </div>

      <div class="result" id="result">
        <div class="resultHeader">
          <h3 id="resultTitle">ä½ çš„è¿åŠ¿ç»“æœ</h3>
          <div class="badge" id="levelBadge">å¥½è¿å€¼ï¼š--</div>
        </div>

        <div class="scoreRow">
          <div class="bar">
            <div class="barTop"><span>æ€»è¯„</span><span id="s_total">--</span></div>
            <div class="track"><div class="fill" id="b_total"></div></div>
          </div>

          <div class="bar">
            <div class="barTop"><span>äº‹ä¸š</span><span id="s_career">--</span></div>
            <div class="track"><div class="fill" id="b_career"></div></div>
          </div>

          <div class="bar">
            <div class="barTop"><span>è´¢è¿</span><span id="s_money">--</span></div>
            <div class="track"><div class="fill" id="b_money"></div></div>
          </div>

          <div class="bar">
            <div class="barTop"><span>æ„Ÿæƒ…</span><span id="s_love">--</span></div>
            <div class="track"><div class="fill" id="b_love"></div></div>
          </div>

          <div class="bar">
            <div class="barTop"><span>å¥åº·</span><span id="s_health">--</span></div>
            <div class="track"><div class="fill" id="b_health"></div></div>
          </div>
        </div>

        <div class="meta" id="metaTags"></div>

        <div class="advice" id="adviceText"></div>

        <!-- æ–°å¢ï¼šæµ·æŠ¥æŒ‰é’®ï¼ˆä¸æ”¹å˜åŸé€»è¾‘ï¼‰ -->
        <button class="btn" id="posterBtn" style="margin-top:12px;display:none;">ğŸ“Œ ç”Ÿæˆåˆ†äº«æµ·æŠ¥</button>
      </div>

      <div class="footer">
        æç¤ºï¼šæœ¬é¡µä¸ºå¨±ä¹å‘æµ‹ç®—ç»“æœï¼Œä»…ä½œå¿ƒæƒ…å‚è€ƒã€‚<br/>
        ä½ å¯ä»¥æ”¹æˆâ€œæŠ½ç­¾â€â€œå¡”ç½—â€â€œç”Ÿè‚–â€ç­‰ä¸»é¢˜ï¼Œæˆ‘ä¹Ÿèƒ½ç»§ç»­å‡çº§ã€‚
      </div>
    </div>
  </div>

  <!-- æ–°å¢ï¼šæµ·æŠ¥å¼¹çª— -->
  <div id="posterModal" style="
    position:fixed;inset:0;
    background:rgba(0,0,0,.55);
    display:none;
    justify-content:center;
    align-items:center;
    padding:18px;
    z-index:9999;
  ">
    <div style="
      width:min(420px,100%);
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.18);
      border-radius:22px;
      padding:14px;
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      box-shadow: 0 18px 50px rgba(0,0,0,.35);
      position:relative;
    ">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
        <div style="color:rgba(255,255,255,.88);font-weight:900;">ä½ çš„åˆ†äº«æµ·æŠ¥</div>
        <button id="closePoster" style="
          background:rgba(255,255,255,.10);
          border:1px solid rgba(255,255,255,.18);
          color:rgba(255,255,255,.9);
          border-radius:999px;
          padding:6px 10px;
          cursor:pointer;
        ">å…³é—­</button>
      </div>

      <div style="border-radius:18px;overflow:hidden;border:1px solid rgba(255,255,255,.14);">
        <canvas id="posterCanvas" width="1080" height="1920" style="width:100%;display:block;"></canvas>
      </div>

      <div style="margin-top:10px;color:rgba(255,255,255,.75);font-size:12px;line-height:1.6;">
        ğŸ“± æ‰‹æœºï¼šé•¿æŒ‰å›¾ç‰‡ä¿å­˜åˆ°ç›¸å†Œ<br/>
        ğŸ’» ç”µè„‘ï¼šç‚¹å‡»ã€Œä¸‹è½½æµ·æŠ¥ã€ä¿å­˜
      </div>

      <button class="btn" id="downloadPoster" style="margin-top:10px;">â¬‡ï¸ ä¸‹è½½æµ·æŠ¥</button>
    </div>
  </div>

  <script>
    // ---------- helpers ----------
    const $ = (id) => document.getElementById(id);
    const today = new Date();
    const fmt = (d) => {
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const da = String(d.getDate()).padStart(2,'0');
      return `${y}.${m}.${da}`;
    };
    $("todayStr").textContent = fmt(today);

    // seeded random: make same inputs produce stable results (optional)
    function hashSeed(str){
      let h = 2166136261;
      for (let i = 0; i < str.length; i++){
        h ^= str.charCodeAt(i);
        h += (h << 1) + (h << 4) + (h << 7) + (h << 8) + (h << 24);
      }
      return (h >>> 0);
    }
    function mulberry32(a){
      return function(){
        let t = a += 0x6D2B79F5;
        t = Math.imul(t ^ t >>> 15, t | 1);
        t ^= t + Math.imul(t ^ t >>> 7, t | 61);
        return ((t ^ t >>> 14) >>> 0) / 4294967296;
      }
    }
    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

    const colors = ["ç²‰é›¾ç«ç‘°","æµ·ç›è“","è–„è·ç»¿","æš®å…‰ç´«","ç¥ç€é‡‘","æœˆå…‰é“¶","çŠç‘šæ©™","æ·±ç©ºè“"];
    const actions = [
      "æŠŠé‡è¦äº‹æƒ…å†™æˆæ¸…å•ï¼Œä¼šè®©ä½ æ›´é¡ºã€‚",
      "ä»Šå¤©é€‚åˆä¸»åŠ¨ä¸€ç‚¹ï¼šå‘æ¶ˆæ¯ã€ææ–¹æ¡ˆã€äº‰å–æœºä¼šã€‚",
      "å°‘ä¸€ç‚¹çº ç»“ï¼Œå¤šä¸€ç‚¹è¡ŒåŠ¨ï¼Œä½ ä¼šæ”¶è·æƒŠå–œã€‚",
      "å»ºè®®æ—©ç¡æˆ–å°‘ç†¬å¤œï¼Œä½ çš„çŠ¶æ€å°±æ˜¯è¿æ°”æ¥æºã€‚",
      "æœ‰å¥½æ¶ˆæ¯åœ¨è·¯ä¸Šï¼Œä¿æŒè€å¿ƒä¸ç¤¼è²Œã€‚",
      "é€‚åˆæ–­èˆç¦»ï¼šæ¸…ç†æ¡Œé¢/æ‰‹æœºç›¸å†Œï¼Œä¼šå¸¦æ¥è½»ç›ˆæ„Ÿã€‚",
      "ç»™è‡ªå·±ä¸€ç‚¹å¥–åŠ±ï¼ˆé¥®å“/æ•£æ­¥/éŸ³ä¹ï¼‰ï¼Œå¥½è¿æ›´å®¹æ˜“å‡ºç°ã€‚",
      "ä¸è¦è¢«æƒ…ç»ªå¸¦èµ°ï¼Œå…ˆè§£å†³æœ€å°çš„é—®é¢˜ï¼Œå†å¤„ç†å¤§çš„ã€‚",
      "ä»Šå¤©é€‚åˆè°ˆåˆä½œï¼šç”¨æ•°æ®è¯´è¯æ›´æœ‰è¯´æœåŠ›ã€‚",
      "é‡åˆ°åˆ†æ­§å…ˆå€¾å¬ï¼Œåè€Œèƒ½æŒæ§å±€é¢ã€‚"
    ];
    const overviewText = [
      "æ•´ä½“èƒ½é‡ä¸Šæ‰¬ï¼Œè¶Šä¸»åŠ¨è¶Šæœ‰æ”¶è·ã€‚",
      "èŠ‚å¥å¹³ç¨³ï¼Œé€‚åˆæŠŠä¹‹å‰çš„äº‹æƒ…æ”¶å°¾ã€‚",
      "çµæ„Ÿä¸é”™ï¼Œåˆ«æ€¥ç€å¦å®šè‡ªå·±ã€‚",
      "æœ‰ç‚¹å°æ³¢åŠ¨ï¼Œä½†ä½ èƒ½ç¨³ä½å±€é¢ã€‚",
      "è¿åŠ¿åå¼ºï¼Œå…³é”®æ˜¯æŠ“ä½ç¬¬ä¸€æ—¶é—´çš„æœºä¼šã€‚"
    ];

    function levelFromScore(score){
      if(score >= 90) return "è¶…å¼ºè¿åŠ¿ ğŸ†";
      if(score >= 80) return "å¥½è¿çˆ†æ£š âœ¨";
      if(score >= 70) return "ç¨³ä¸­å‘å¥½ ğŸŒ¤ï¸";
      if(score >= 60) return "å°æœ‰èµ·ä¼ ğŸŒ™";
      return "éœ€è¦è“„åŠ› ğŸƒ";
    }

    function renderScore(idScore, idBar, v){
      $(idScore).textContent = v + " / 100";
      requestAnimationFrame(() => {
        $(idBar).style.width = v + "%";
      });
    }

    function genFortune(){
      const name = $("name").value.trim() || "ä½ ";
      const zodiac = $("zodiac").value;
      const date = $("date").value || fmt(new Date()).replaceAll(".","-");
      const seedStr = `${name}|${zodiac}|${date}`;
      const rnd = mulberry32(hashSeed(seedStr));

      // base score with slight bias depending on zodiac
      const zodiacBias = (z) => {
        const map = {
          "ç™½ç¾Šåº§": 4, "é‡‘ç‰›åº§": 2, "åŒå­åº§": 3, "å·¨èŸ¹åº§": 1,
          "ç‹®å­åº§": 4, "å¤„å¥³åº§": 2, "å¤©ç§¤åº§": 3, "å¤©èåº§": 3,
          "å°„æ‰‹åº§": 4, "æ‘©ç¾¯åº§": 2, "æ°´ç“¶åº§": 3, "åŒé±¼åº§": 2
        };
        return map[z] || 2;
      };

      const base = 58 + Math.floor(rnd()*28) + zodiacBias(zodiac);
      const career = clamp(base + Math.floor(rnd()*18) - 8, 35, 98);
      const money  = clamp(base + Math.floor(rnd()*20) - 10, 30, 98);
      const love   = clamp(base + Math.floor(rnd()*22) - 12, 25, 99);
      const health = clamp(base + Math.floor(rnd()*16) - 6, 40, 99);
      const total  = clamp(Math.round((career + money + love + health) / 4 + (rnd()*6 - 3)), 30, 99);

      const luckColor = colors[Math.floor(rnd()*colors.length)];
      const luckNum = 1 + Math.floor(rnd()*9);
      const luckyTime = ["08:00-10:00","10:00-12:00","12:00-14:00","14:00-16:00","16:00-18:00","19:00-21:00"][Math.floor(rnd()*6)];
      const luckyItem = ["è€³æœºğŸ§","å’–å•¡â˜•","ç¬”è®°æœ¬ğŸ“’","é¦™æ°´ğŸŒ¸","é’¥åŒ™æ‰£ğŸ”‘","æ‰‹é“¾ğŸ“¿","è–„è·ç³–ğŸ¬","è¿åŠ¨é‹ğŸ‘Ÿ"][Math.floor(rnd()*8)];
      const overview = overviewText[Math.floor(rnd()*overviewText.length)];
      const action = actions[Math.floor(rnd()*actions.length)];

      // compose advice
      const advice = `ã€${name} Â· ${zodiac}ã€‘\n` +
        `${overview}\n\n` +
        `âœ… ä»Šæ—¥è¡ŒåŠ¨å»ºè®®ï¼š${action}\n` +
        `ğŸ’¡ å°æç¤ºï¼šæŠŠæœ€é‡è¦çš„ä¸€ä»¶äº‹â€œå…ˆåš 10 åˆ†é’Ÿâ€ï¼Œä½ ä¼šå‘ç°å¥½è¿ä¼šè·Ÿç€åŠ¨èµ·æ¥ã€‚`;

      return {name, zodiac, date, total, career, money, love, health, luckColor, luckNum, luckyTime, luckyItem, advice};
    }

    // =========================
    // è¿åŠ¿æŒ‰é’®é€»è¾‘ï¼ˆåŸé€»è¾‘ä¸å˜ï¼‰
    // =========================
    const btn = $("btn");
    btn.addEventListener("click", () => {
      btn.disabled = true;
      btn.textContent = "ğŸ”® æ­£åœ¨æŠ½å–è¿åŠ¿...";

      // reset bars
      ["total","career","money","love","health"].forEach(k=>{
        $("b_"+k).style.width = "0%";
        $("s_"+k).textContent = "--";
      });

      setTimeout(() => {
        const f = genFortune();

        // âœ… æ–°å¢ï¼šè®°å½•æœ¬æ¬¡è¿åŠ¿ï¼Œä¾›æµ·æŠ¥ä½¿ç”¨
        lastFortune = f;

        $("result").style.display = "block";

        $("resultTitle").textContent = `${f.name}çš„ä»Šæ—¥è¿åŠ¿ç»“æœ`;
        $("levelBadge").textContent = `${levelFromScore(f.total)} Â· ${f.total}`;

        renderScore("s_total", "b_total", f.total);
        renderScore("s_career", "b_career", f.career);
        renderScore("s_money", "b_money", f.money);
        renderScore("s_love", "b_love", f.love);
        renderScore("s_health", "b_health", f.health);

        // tags
        $("metaTags").innerHTML = "";
        const tags = [
          `å¹¸è¿è‰²ï¼š${f.luckColor}`,
          `å¹¸è¿æ•°å­—ï¼š${f.luckNum}`,
          `å¹¸è¿æ—¶æ®µï¼š${f.luckyTime}`,
          `å¹¸è¿ç‰©ï¼š${f.luckyItem}`,
          `å…³é”®è¯ï¼š${f.total>=80 ? "ä¸»åŠ¨ / å¸å¼•åŠ›" : f.total>=65 ? "èŠ‚å¥ / ç¨³å®š" : "è“„åŠ› / è°ƒæ•´"}`
        ];
        tags.forEach(t=>{
          const el = document.createElement("div");
          el.className = "tag";
          el.textContent = t;
          $("metaTags").appendChild(el);
        });

        $("adviceText").textContent = f.advice;

        // âœ… æ–°å¢ï¼šæ˜¾ç¤ºç”Ÿæˆæµ·æŠ¥æŒ‰é’®
        $("posterBtn").style.display = "block";

        btn.disabled = false;
        btn.textContent = "âœ¨ å†æµ‹ä¸€æ¬¡";
      }, 900);
    });

    // =================================================
    // âœ… æ–°å¢ï¼šç”Ÿæˆåˆ†äº«æµ·æŠ¥åŠŸèƒ½ï¼ˆCanvasç»˜åˆ¶ï¼Œæ— ç¬¬ä¸‰æ–¹åº“ï¼‰
    // =================================================
    let lastFortune = null;

    const posterBtn = $("posterBtn");
    const posterModal = $("posterModal");
    const closePoster = $("closePoster");
    const downloadPoster = $("downloadPoster");
    const canvas = $("posterCanvas");
    const ctx = canvas.getContext("2d");

    function roundRect(ctx, x, y, w, h, r) {
      const rr = Math.min(r, w/2, h/2);
      ctx.beginPath();
      ctx.moveTo(x + rr, y);
      ctx.arcTo(x + w, y, x + w, y + h, rr);
      ctx.arcTo(x + w, y + h, x, y + h, rr);
      ctx.arcTo(x, y + h, x, y, rr);
      ctx.arcTo(x, y, x + w, y, rr);
      ctx.closePath();
    }

    function drawPoster(f){
      const W = canvas.width, H = canvas.height;
      ctx.clearRect(0,0,W,H);

      // èƒŒæ™¯æ¸å˜
      const g = ctx.createLinearGradient(0,0,W,H);
      g.addColorStop(0, "#0A1020");
      g.addColorStop(0.45, "#10182F");
      g.addColorStop(1, "#07101F");
      ctx.fillStyle = g;
      ctx.fillRect(0,0,W,H);

      // æ°›å›´å…‰æ™•
      function glow(x,y,r,color,alpha){
        const rg = ctx.createRadialGradient(x,y,0,x,y,r);
        rg.addColorStop(0, `rgba(${color},${alpha})`);
        rg.addColorStop(1, `rgba(${color},0)`);
        ctx.fillStyle = rg;
        ctx.beginPath();
        ctx.arc(x,y,r,0,Math.PI*2);
        ctx.fill();
      }
      glow(W*0.2, H*0.18, 520, "255,151,197", 0.55);
      glow(W*0.82, H*0.22, 520, "95,187,255", 0.55);
      glow(W*0.45, H*0.88, 620, "153,255,200", 0.40);

      // æ˜Ÿç‚¹
      ctx.globalAlpha = 0.55;
      for(let i=0;i<70;i++){
        const x = Math.random()*W;
        const y = Math.random()*H;
        const s = Math.random()*2.2 + 0.6;
        ctx.fillStyle = "rgba(255,255,255,.85)";
        ctx.beginPath();
        ctx.arc(x,y,s,0,Math.PI*2);
        ctx.fill();
      }
      ctx.globalAlpha = 1;

      // ä¸»å¡ç‰‡ï¼ˆç»ç’ƒæ‹Ÿæ€ï¼‰
      const pad = 78;
      const cardX = pad, cardY = 240, cardW = W - pad*2, cardH = 1320;
      ctx.save();
      ctx.fillStyle = "rgba(255,255,255,.10)";
      ctx.strokeStyle = "rgba(255,255,255,.18)";
      ctx.lineWidth = 2;
      roundRect(ctx, cardX, cardY, cardW, cardH, 54);
      ctx.fill();
      ctx.stroke();
      ctx.restore();

      // è§’æ ‡
      ctx.save();
      ctx.fillStyle = "rgba(255,255,255,.14)";
      roundRect(ctx, cardX+cardW-280, cardY+40, 240, 72, 36);
      ctx.fill();
      ctx.fillStyle = "rgba(255,255,255,.9)";
      ctx.font = "bold 34px -apple-system,BlinkMacSystemFont,'PingFang SC','Microsoft YaHei',sans-serif";
      ctx.fillText("ğŸ”® ä»Šæ—¥è¿åŠ¿", cardX+cardW-255, cardY+90);
      ctx.restore();

      // æ ‡é¢˜
      ctx.fillStyle = "rgba(255,255,255,.94)";
      ctx.font = "900 64px -apple-system,BlinkMacSystemFont,'PingFang SC','Microsoft YaHei',sans-serif";
      ctx.fillText(`${f.name}çš„è¿åŠ¿æŠ¥å‘Š`, cardX+60, cardY+140);

      // å‰¯æ ‡é¢˜
      ctx.fillStyle = "rgba(255,255,255,.72)";
      ctx.font = "38px -apple-system,BlinkMacSystemFont,'PingFang SC','Microsoft YaHei',sans-serif";
      ctx.fillText(`${f.zodiac} Â· ${f.date.replaceAll("-",".")}`, cardX+60, cardY+205);

      // æ€»åˆ†å¤§åœ†
      const cx = cardX + cardW - 185;
      const cy = cardY + 210;
      const R = 110;
      ctx.save();
      ctx.fillStyle = "rgba(255,255,255,.10)";
      ctx.beginPath();
      ctx.arc(cx,cy,R,0,Math.PI*2);
      ctx.fill();
      ctx.strokeStyle = "rgba(255,255,255,.22)";
      ctx.lineWidth = 3;
      ctx.stroke();

      // è¿›åº¦å¼§
      ctx.beginPath();
      ctx.strokeStyle = "rgba(255,255,255,.86)";
      ctx.lineWidth = 10;
      ctx.lineCap = "round";
      const start = -Math.PI/2;
      const end = start + Math.PI*2*(f.total/100);
      ctx.arc(cx,cy,R-18,start,end);
      ctx.stroke();

      ctx.fillStyle = "rgba(255,255,255,.95)";
      ctx.font = "900 78px -apple-system,BlinkMacSystemFont,'PingFang SC','Microsoft YaHei',sans-serif";
      ctx.textAlign = "center";
      ctx.fillText(f.total, cx, cy+22);
      ctx.fillStyle = "rgba(255,255,255,.75)";
      ctx.font = "36px -apple-system,BlinkMacSystemFont,'PingFang SC','Microsoft YaHei',sans-serif";
      ctx.fillText("å¥½è¿å€¼", cx, cy+70);
      ctx.restore();

      // åˆ†é¡¹æ¡
      const bars = [
        ["äº‹ä¸š", f.career],
        ["è´¢è¿", f.money],
        ["æ„Ÿæƒ…", f.love],
        ["å¥åº·", f.health],
      ];

      let y = cardY + 320;
      ctx.textAlign = "left";

      bars.forEach(([k,v])=>{
        ctx.fillStyle = "rgba(255,255,255,.86)";
        ctx.font = "700 44px -apple-system,BlinkMacSystemFont,'PingFang SC','Microsoft YaHei',sans-serif";
        ctx.fillText(k, cardX+60, y);

        ctx.fillStyle = "rgba(255,255,255,.78)";
        ctx.font = "40px -apple-system,BlinkMacSystemFont,'PingFang SC','Microsoft YaHei',sans-serif";
        ctx.fillText(`${v}/100`, cardX+cardW-200, y);

        // track
        const tx = cardX+60, ty = y+28, tw = cardW-120, th = 20;
        ctx.fillStyle = "rgba(255,255,255,.10)";
        roundRect(ctx, tx, ty, tw, th, 999);
        ctx.fill();

        // fill
        ctx.fillStyle = "rgba(255,255,255,.86)";
        roundRect(ctx, tx, ty, tw*(v/100), th, 999);
        ctx.fill();

        y += 120;
      });

      // å¹¸è¿ä¿¡æ¯
      ctx.save();
      ctx.fillStyle = "rgba(255,255,255,.10)";
      roundRect(ctx, cardX+60, y, cardW-120, 230, 42);
      ctx.fill();
      ctx.strokeStyle = "rgba(255,255,255,.16)";
      ctx.stroke();

      ctx.fillStyle = "rgba(255,255,255,.92)";
      ctx.font = "900 48px -apple-system,BlinkMacSystemFont,'PingFang SC','Microsoft YaHei',sans-serif";
      ctx.fillText("å¹¸è¿æç¤º", cardX+95, y+75);

      ctx.fillStyle = "rgba(255,255,255,.82)";
      ctx.font = "40px -apple-system,BlinkMacSystemFont,'PingFang SC','Microsoft YaHei',sans-serif";
      ctx.fillText(`å¹¸è¿è‰²ï¼š${f.luckColor}`, cardX+95, y+140);
      ctx.fillText(`å¹¸è¿æ•°å­—ï¼š${f.luckNum}    å¹¸è¿æ—¶æ®µï¼š${f.luckyTime}`, cardX+95, y+195);
      ctx.restore();

      // å»ºè®®æ–‡æ¡ˆï¼ˆè‡ªåŠ¨æ¢è¡Œï¼‰
      const adviceBoxY = y + 270;
      ctx.save();
      ctx.fillStyle = "rgba(10,16,32,.30)";
      ctx.strokeStyle = "rgba(255,255,255,.16)";
      ctx.setLineDash([10,8]);
      roundRect(ctx, cardX+60, adviceBoxY, cardW-120, 330, 42);
      ctx.fill();
      ctx.stroke();
      ctx.setLineDash([]);

      ctx.fillStyle = "rgba(255,255,255,.90)";
      ctx.font = "900 46px -apple-system,BlinkMacSystemFont,'PingFang SC','Microsoft YaHei',sans-serif";
      ctx.fillText("ä»Šæ—¥å»ºè®®", cardX+95, adviceBoxY+80);

      const text = f.advice.replace(/\n/g," ").replace(/\s+/g," ").trim();
      ctx.fillStyle = "rgba(255,255,255,.80)";
      ctx.font = "38px -apple-system,BlinkMacSystemFont,'PingFang SC','Microsoft YaHei',sans-serif";
      const maxWidth = cardW - 190;
      let line = "", lineY = adviceBoxY+145;
      for(const ch of text){
        const test = line + ch;
        if(ctx.measureText(test).width > maxWidth){
          ctx.fillText(line, cardX+95, lineY);
          line = ch;
          lineY += 56;
          if(lineY > adviceBoxY + 300) break;
        }else{
          line = test;
        }
      }
      if(lineY <= adviceBoxY + 300) ctx.fillText(line, cardX+95, lineY);
      ctx.restore();

      // åº•éƒ¨å“ç‰Œ & å¼•å¯¼
      ctx.save();
      ctx.fillStyle = "rgba(255,255,255,.65)";
      ctx.font = "34px -apple-system,BlinkMacSystemFont,'PingFang SC','Microsoft YaHei',sans-serif";
      ctx.textAlign = "center";
      ctx.fillText("æ‰«ä¸€æ‰« / æˆªå›¾åˆ†äº«ç»™æœ‹å‹ï¼Œä¸€èµ·æ¥å¥½è¿ âœ¨", W/2, H-170);
      ctx.fillStyle = "rgba(255,255,255,.55)";
      ctx.font = "30px -apple-system,BlinkMacSystemFont,'PingFang SC','Microsoft YaHei',sans-serif";
      ctx.fillText("ï¼ˆå¨±ä¹å‘æµ‹ç®—ï¼Œä»…ä¾›å¿ƒæƒ…å‚è€ƒï¼‰", W/2, H-120);
      ctx.restore();
    }

    function openPoster(){
      if(!lastFortune) return;
      drawPoster(lastFortune);
      posterModal.style.display = "flex";
    }

    posterBtn.addEventListener("click", openPoster);
    closePoster.addEventListener("click", ()=> posterModal.style.display="none");
    posterModal.addEventListener("click", (e)=>{
      if(e.target === posterModal) posterModal.style.display="none";
    });

    downloadPoster.addEventListener("click", ()=>{
      const a = document.createElement("a");
      a.download = "fortune_poster.png";
      a.href = canvas.toDataURL("image/png");
      a.click();
    });
  </script>
</body>
</html>
